{% extends "base.html" %}
{% block content %}
<div class="panel">
    <h2>Pattern Editor</h2>
    <div class="control-group">
        <h3>Pattern Type</h3>
        <select id="pattern-type" onchange="updatePatternForm()">
            <option value="serpentine">Serpentine</option>
            <option value="spiral">Spiral</option>
            <option value="custom">Custom</option>
        </select>
    </div>

    <div class="control-group">
        <h3>Pattern Parameters</h3>
        <form id="pattern-form">
            <!-- Serpentine Parameters -->
            <div id="serpentine-params">
                <input type="number" name="length" placeholder="Length (mm)" required>
                <input type="number" name="width" placeholder="Width (mm)" required>
                <input type="number" name="spacing" placeholder="Line Spacing (mm)" required>
                <input type="number" name="velocity" placeholder="Velocity (mm/s)" required>
            </div>

            <!-- Spiral Parameters -->
            <div id="spiral-params" style="display: none;">
                <input type="number" name="start_radius" placeholder="Start Radius (mm)" required>
                <input type="number" name="end_radius" placeholder="End Radius (mm)" required>
                <input type="number" name="spacing" placeholder="Spiral Spacing (mm)" required>
                <input type="number" name="velocity" placeholder="Velocity (mm/s)" required>
            </div>

            <button type="submit">Save Pattern</button>
        </form>
    </div>

    <div class="control-group">
        <h3>Pattern Preview</h3>
        <canvas id="pattern-preview"></canvas>
    </div>
</div>

<script>
function updatePatternForm() {
    const type = document.getElementById('pattern-type').value;
    document.getElementById('serpentine-params').style.display = 
        type === 'serpentine' ? 'block' : 'none';
    document.getElementById('spiral-params').style.display = 
        type === 'spiral' ? 'block' : 'none';
}

document.getElementById('pattern-form').onsubmit = async (e) => {
    e.preventDefault();
    const form = e.target;
    const type = document.getElementById('pattern-type').value;
    
    try {
        const response = await fetch(`${API_URLS.process}/patterns`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                type,
                parameters: Object.fromEntries(new FormData(form))
            })
        });
        if (!response.ok) throw await response.json();
        showSuccess('Pattern saved');
    } catch (error) {
        showError(error.detail || 'Failed to save pattern');
    }
};

async function loadConfig() {
    const configType = document.getElementById('config-select').value;
    const editor = document.getElementById('config-editor');
    try {
        editor.disabled = true;
        const response = await fetch(`${API_URLS.config}/${configType}`);
        if (!response.ok) throw await response.json();
        const config = await response.json();
        editor.value = JSON.stringify(config, null, 2);
    } catch (error) {
        showError('Failed to load config');
    } finally {
        editor.disabled = false;
    }
}
</script>
{% endblock %}